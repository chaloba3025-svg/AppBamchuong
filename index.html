<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
  <title>App Bấm Chuông</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #8B0000;
      margin: 0;
      padding: 0;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    #main-container { width: 100%; max-width: 600px; padding: 20px; box-sizing: border-box; }
    h1 { color: #FFFFFF; font-size: 2.5em; margin-bottom: 50px; }
    #start-view button, #join-view-buttons button, #recovery-view button {
      width: 80%; max-width: 300px; padding: 20px 0; font-size: 1.8em; cursor: pointer;
      border: none; border-radius: 10px; color: white; margin: 15px auto; display: block;
      transition: background-color 0.3s ease;
    }
    #createRoomBtn { background-color: #28a745; }
    #joinRoomBtn { background-color: #007bff; }
    #start-view button:hover { opacity: 0.9; }
    .input-view { display: flex; flex-direction: column; align-items: center; }
    .input-box {
      width: 250px; height: 100px; background-color: #ffd700; border-radius: 10px;
      font-size: 3em; font-weight: bold; color: #000; border: 2px solid #000;
      text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .next-button {
      width: 0; height: 0; border-top: 50px solid transparent; border-bottom: 50px solid transparent;
      border-left: 80px solid #007bff; margin-top: 20px; cursor: pointer;
    }
    #control-panel { margin-bottom: 30px; }
    #control-panel button {
      padding: 15px 30px; font-size: 1.2em; cursor: pointer;
      border: none; border-radius: 8px; background-color: #007bff; color: white; margin: 5px;
    }
    #countdown-display, #countdown-display-player { font-size: 4em; font-weight: bold; color: #dc3545; margin-top: 20px; }
    #buzzer-button {
      width: 150px; height: 150px; border-radius: 50%; border: 4px solid #fff; background-color: #dc3545;
      color: white; font-size: 1.5em; font-weight: bold; display: flex; justify-content: center; align-items: center;
      cursor: pointer; transition: background-color 0.3s, transform 0.1s ease-in-out;
    }
    #buzzer-button.disabled { background-color: #ccc !important; cursor: not-allowed; animation: none !important; }
    #buzzer-button:active:not(.disabled) { transform: scale(0.95); }
    @keyframes shake { 0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)} }
    #buzzer-button:not(.disabled) { animation: shake 0.5s infinite; }
    .buzzer-blue { background-color: #007bff !important; }
    .buzzer-green { background-color: #28a745 !important; }
    #results-panel { width: 100%; max-width: 500px; background-color: #fff; padding: 20px; border-radius: 10px; margin-top: 20px; }
    #results-list { list-style: none; padding: 0; margin: 0; }
    #results-list li { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
    .player-rank { font-weight: bold; } .player-time { color: #888; }
    .hidden { display: none; }
    #players-list { list-style: none; padding: 0; margin-top: 20px; background-color: #fff; border-radius: 8px; max-height: 200px; overflow-y: auto; }
    #players-list li { font-size: 1.2em; padding: 10px 15px; border-bottom: 1px solid #eee; color: #ffd700; font-weight: bold; background-color: #333; }
    #recovery-view { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; padding: 20px; box-sizing: border-box; }
    #returnToOldRoomBtn { background-color: #28a745; } #returnToHomeBtn { background-color: #dc3545; }
  </style>
</head>
<body>
  <div id="main-container">
    <div id="start-view" class="hidden">
      <h1>APP BẤM CHUÔNG</h1>
      <button id="createRoomBtn">TẠO PHÒNG</button>
      <button id="joinRoomBtn">VÀO PHÒNG</button>
    </div>
    <div id="recovery-view" class="hidden">
      <h1>APP BẤM CHUÔNG</h1>
      <button id="returnToOldRoomBtn">ROOM CŨ</button>
      <button id="returnToHomeBtn">HOME</button>
    </div>
    <div id="enter-room-view" class="input-view hidden">
      <h1>Nhập mã phòng</h1>
      <input type="text" id="roomCodeInput" class="input-box" placeholder="Mã phòng">
      <div id="nextRoomBtn" class="next-button"></div>
    </div>
    <div id="enter-name-view" class="input-view hidden">
      <h1>Tên bạn</h1>
      <input type="text" id="nameInput" class="input-box" placeholder="Tên của bạn">
      <div id="nextNameBtn" class="next-button"></div>
    </div>
    <div id="master-view" class="hidden">
      <h1>Mã phòng của bạn là: <span id="roomCodeDisplay"></span></h1>
      <p>Người chơi trong phòng:</p>
      <ul id="players-list"></ul>
      <div id="control-panel">
        <button id="startButton">BẮT ĐẦU VÒNG CHƠI</button>
        <button id="newRoundBtn" class="hidden">VÒNG MỚI</button>
      </div>
      <div id="countdown-display" class="hidden"></div>
    </div>
    <div id="player-view" class="hidden">
      <h1>Bạn hãy bấm nút!</h1>
      <div id="buzzer-button">BẤM</div>
      <div id="countdown-display-player" class="hidden"></div>
    </div>
    <div id="results-panel" class="hidden">
      <h2>Kết quả:</h2>
      <ul id="results-list"></ul>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAAdt8pjiOTBCFuDEv_1BWZlPQYtJBWdZY",
      authDomain: "appchuong-c3fb8.firebaseapp.com",
      projectId: "appchuong-c3fb8",
      storageBucket: "appchuong-c3fb8.firebasestorage.app",
      messagingSenderId: "794046720932",
      appId: "1:794046720932:web:8fe3166394b7e366dbaf31"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM elements
    const startView = document.getElementById('start-view');
    const recoveryView = document.getElementById('recovery-view');
    const masterView = document.getElementById('master-view');
    const playerView = document.getElementById('player-view');
    const resultsPanel = document.getElementById('results-panel');
    const roomCodeDisplay = document.getElementById('roomCodeDisplay');
    const playersList = document.getElementById('players-list');
    const buzzerButton = document.getElementById('buzzer-button');
    const countdownDisplay = document.getElementById('countdown-display');
    const countdownDisplayPlayer = document.getElementById('countdown-display-player');
    const resultsList = document.getElementById('results-list');

    // State
    let isMaster = false, myName = '', currentRoomCode = '', currentRoundId = '';
    let hasPressedThisRound = false, hasPlayedSoundForThisRound = false;

    // Helpers
    const showView = (id) => {
      document.querySelectorAll('#main-container > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    };

    const playRingSound = () => {
      const audio = new Audio('https://github.com/chaloba3025-svg/AppBamchuong/raw/refs/heads/main/bam_gianh_quyen_tra_loi.mp3');
      audio.play().catch(()=>{});
    };

    // Load state on refresh
    const handleInitialLoad = () => {
      const savedRoomCode = localStorage.getItem('currentRoomCode');
      const savedIsMaster = localStorage.getItem('isMaster');
      if (savedRoomCode) {
        showView('recovery-view'); // chỉ hiển thị ROOM CŨ + HOME
      } else {
        showView('start-view');
      }
    };
    handleInitialLoad();

    // TODO: các event listener (tạo phòng, join phòng, bấm chuông...) giữ nguyên như cũ
    // -> bạn chỉ cần thay phần showView thay vì add/remove class thủ công
  </script>
</body>
</html>


